<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="main">

	<select id="allSearchList" resultType="first.com.model.BoardDTO" parameterType="java.util.Map">
	<![CDATA[SELECT * FROM (SELECT board_id, member_id, board_title, board_content, board_date, board_nickname, board_hit, board_like, 
	board_comment_count, bgroup_id, scrap_count,rownum r FROM (SELECT b.*, count(a.scrap_id) as scrap_count FROM 
	(SELECT /*+index(board IDX_BOARD_DATE)*/ board_id, member_id, board_title, board_content, board_date, board_nickname, board_hit, board_like, board_comment_count, 
	bgroup_id FROM board WHERE BOARD_TITLE like '%'||#{search}||'%' OR 
	BOARD_CONTENT like '%'||#{search}||'%' OR BOARD_NICKNAME like '%'||#{search}||'%') b LEFT OUTER JOIN 
	scrap a ON a.board_id = b.board_id GROUP BY b.board_id, b.member_id, b.board_title, b.board_content, 
	b.board_date, b.board_nickname, b.board_hit, b.board_like, b.board_comment_count, b.bgroup_id ORDER BY ${category} DESC) 
	WHERE rownum <= #{endrow} ) WHERE r >= #{startrow}]]>
	</select>
	
	<select id="allBoardCount" resultType="int" parameterType="java.util.Map">
	SELECT COUNT(board_id) FROM board WHERE BOARD_TITLE like '%'||#{search}||'%' OR 
	BOARD_CONTENT like '%'||#{search}||'%' OR BOARD_NICKNAME like '%'||#{search}||'%'
	</select>

</mapper>